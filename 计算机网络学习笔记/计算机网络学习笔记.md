# 第一章 计算机网络和因特网

## 电路交换

电路交换: 传统的电路交换要求每个主机之间必须直接连接, 假设网络中有 $n$ 台主机, 就必须使用 $C_n^2$ 条链路, 十分浪费资源. 为了改进, 引入交换机, 让主机连入到交换机上, 通过交换技术实现两台主机的连接.

主机连接到交换机速率远远小于两个交换机之间的速率, 为了提高两个交换机之间链路的利用率, 引入多路复用技术, 实现多个主机同时连接到一个交换机上.
多路复用: 将网络资源划分为资源片, 将资源片分配给各路称之为 calls. 每个 call 独占资源片进行通信. 典型的多路复用技术: 频分多路复用, 时分多路复用, 波分多路复用, 码分多路复用.

- 频分多路复用FDM: 每个用户占用不同的宽带频率, 单位Hz. 用户得到一定的频率之后通信过程中始终占用该频率.
- 时分多路复用TDM: 将时间段划分为等长的时分复用帧, 每个用户占用固定序号的时隙. 各用户占用的时隙是周期性出现的.
- 波分多路复用WDM: 将不同的波长分配给不同的用户, 在光通信系统中常见.
- 码分复用CDM: 多用于无线通信网络, 为每个用户分配一个m比特的唯一码片序列. 用户使用相同频率的载波, 利用各自的码片序列编码数据. 编码信号=原始数据*码片序列. 对于一个用户, 他想要发送它的数据, 那么假如该数据是 0 , 则发送自己的 m比特的码片序列. 如果数据是 1, 就发送 m比特码片序列的补码.并且要求个用户的码片序列相互正交.

## 报文交换

报文: 应用(源)发送信息整体.

## 分组交换

每个ISP本身就是有多台分组交换机和多段通信链路组成的网络.  
IP协议定义了在路由器和端系统之间发送和接收的分组格式.  
Socket interface 规定了运行在一个端系统上的程序请求因特网基础设施向运行在另外一个端系统上的特定目的地程序交换数据的方式.  
在源和目的地之间, 每个分组都通过通信链路和分组交换机传送.  
交换机分为两种: 路由器和链路层交换机.  

分组: 报文拆分出来的一系列较小的数据包, 分组需要报文的拆分与重组, 会产生额外的开销.  
分组交换采用统计多路复用.  
分组交换的交换的特点:

- 存储转发传输: 与报文交换机能够开始向输出链路传输该分组的第一个比特之前, 必须接收到整个分组. 仅当路由器接收到所有分组之后才能向链路传输该分组. 通过 $N$ 条速率均为 $R$ 的链路组成的路径, 从源到目的地发送一个分组, 端到端的时延是 $d_{端到端}==N*L/R$
- 排队时延与分组丢失: 对于每条相连的链路, 该分组交换机有一个输出缓存(输出队列), 用于存储路由器准备发往那条链路的分组.  因此分组需要承受输出缓存的排队时延.
- 转发表和路由选择协议: 当源主机要向目的地端系统发送一个分组时, 源在该分组的首部包含了目的地的IP地址. 路由器有一个转发表, 用于将目的地址映射为输出链路, 路由器会根据分组的地址在转发表里面查找对应的输出链路.

分组交换与报文交换都是采用存储-转发交换方式. 报文交换以完整报文进行 "存储-转发", 分组交换以较小的分组进行 "存储-转发".  
![分组交换](计算机网络学习笔记.assets/2020-11-16-16-27-51.png)  

**报文交换与分组交换的区别:**  
![区别](计算机网络学习笔记.assets/2020-11-16-16-31-12.png)  
![报文交换](计算机网络学习笔记.assets/2020-11-16-16-32-59.png)  
缓存大小至少要 7.5 mb.  
![分组交换](计算机网络学习笔记.assets/2020-11-16-16-36-35.png)  
分组交换远远优越于报文交换.  

分组交换的报文交付时间:  
![分组交换报文交付时间](计算机网络学习笔记.assets/2020-11-16-16-39-30.png)  

**分组交换与电路交换**
![分组交换](计算机网络学习笔记.assets/2020-11-16-16-55-02.png)  

1. 分组交换更适合于突发式的数据网络传输.
   - 资源充分共享
   - 简单,无需呼叫建立
2. 可能产生拥塞现象: 分组延迟和丢失
   - 需要协议处理可靠数据传输和拥塞控制

## 计算机网络性能

速率: 单位时间内传输比特量, b/s, kb/s, Mb/s  
带宽: 原来指信号具有的频带宽度, 及最高频率个最低频率的差, 单位是Hz. 在网络中通常是数字信道所能传输的 "最高速率", 单位是 b/s.  
时延:  
为什么分组交换会发生丢包和时延?  
分组在路由器缓存中排队. 分组到达的速率远远超出输出链路容量, 分组排队,等待链路可用.  

四种分组延迟:

1. $d_{proc}$ 节点处理延迟
   1. 差错检测
   2. 确定输出链路
   3. 通常小于 msec
2. $d_{queue}$ 排队延迟
   1. 等待输出链路可用
   2. 取决于路由器的拥塞程度
3. $d_{trans}$ 传输延迟, 将所有分组推向链路的时间, $d_{trans}=L/R$
   1. L: 分组长度
   2. R: 链路带宽
4. $d_{prop}$ 传播延迟,链路的物理性质, $d_{prop}=d/s$
   1. d: 物理链路的长度
   2. s: 信号传播的速度

**排队延迟$d_{queue}$**  
R: 链路带宽  
L: 分组长度  
a: 平均分组到达的速率  
如果 $La/R$~0, 平均排队延迟很小.  
如果 $La/R$~1, 平均排队延迟很大.  
如果 $La/R$>1, 平均排队延迟无限大.

**时延带宽积 = 传播延时$d_{prop}$*带宽.** 得到的单位是 $bit$, 又被称为以比特为单位的链路长度.

分组丢失: 当路由器的队列缓存满了, 后来到达的包就会丢失.  

吞吐量: 发送端到接收端之间传送数据速率.在实际网络中, 吞吐量主要取决于瓶颈速率, 通常是主机到交换机或者链路速率  
即时吞吐量: 给定时刻的速率  
平均吞吐量: 一段时间内的平均速率  

## 计算机网络体系结构

![分层基本概念](计算机网络学习笔记.assets/2020-11-16-17-56-16.png)  

## OSI 参考模型

![OSI](计算机网络学习笔记.assets/2020-11-16-18-03-33.png)  
![分层](计算机网络学习笔记.assets/2020-11-16-18-11-10.png)  
![数据封装](计算机网络学习笔记.assets/2020-11-16-18-16-27.png)  
![为什么要进行数据封装](计算机网络学习笔记.assets/2020-11-16-18-19-00.png)  

**物理层的功能:**

- 接口特性
  - 机械特性, 电气特性..
- 比特编码
- 数据率
- 比特同步
  - 时钟同步
- 传输模式
  - 单工通信, 半双工, 双工

**数据链路层功能:**

- 负责结点-结点数据传输  
- 组帧  
- 物理寻址: 在帧头中增加发送端/接收端的物理地址标识数据帧的发送端/接收端
- 流量控制: 避免淹没接收端, 匹配发送速度和接收速度
- 差错控制: 检测并重传损坏或者丢失帧, 避免重复帧
- 接入控制(访问控制): 在某一时刻决定哪个设备拥有链路(物理介质)控制权

**网络层功能:**

- 负责源主机到目的主机数据分组的交付  
  - 可能跨越多个网络
- 逻辑寻址
  - 全局唯一逻辑地址, 确保数据分组被送到目的主机(IP地址)
- 路由
  - 路由器互联网络, 并路由分组到最终目的主机
  - 路径转发
- 分组转发

**传输层功能:**

![传输层](计算机网络学习笔记.assets/2020-11-16-20-06-02.png)  
负责源-目的(端-端)(进程之间)间完整报文传输.  

- 报文分段,重组
- SAP寻址
  - 确保将报文提交给正确进程, 如端口号  
  ![寻址](计算机网络学习笔记.assets/2020-11-16-20-11-20.png)  
- 连接控制
- 流量控制
- 差错控制

**会话层功能:**

![会话层](计算机网络学习笔记.assets/2020-11-16-20-14-34.png)  

- 对话控制
  - 建立,维护
- 同步
  - 在数据流中插入"同步点"
- 最薄的一层

**表示层功能:**

![表示层](计算机网络学习笔记.assets/2020-11-16-20-15-43.png)  
处理两个系统间交换信息的语法和语义问题

- 数据表示转化
  - 转化为主机独立的编码, 到达之后再转化为主机相关的编码
- 加密,解密
- 压缩,解压缩

**应用层功能:**

![应用层](计算机网络学习笔记.assets/2020-11-16-20-18-58.png)  
支持用户通过用户代理或者网络接口使用网络(服务)  
典型的网络应用:

- 文件传输 FTP
- 电子邮件 SMTP
- Web HTTP...

## TCP/IP 参考模型

![tcp/ip](计算机网络学习笔记.assets/2020-11-16-20-22-53.png)  

**五层参考模型:**  
![五层参考模型](计算机网络学习笔记.assets/2020-11-16-20-25-54.png)  
五层模型的数据封装  
![数据封装](计算机网络学习笔记.assets/2020-11-16-20-29-31.png)  

## 课后习题

1. 与分组交换网络相比, 电路交换网络的优点? 以及TDM比FDM的优点?
   - 电路交换⽹络可以在响应时间内保证⼀定量的端到端带宽。如今⼤部分分组交换⽹络（包括因特⽹）⽆法保证端到端带宽。FDM需要复杂的模拟硬件来将信号转换为合适的频率。

2. 端到端的时延中组成成分中哪些时延是固定的?
   - 延迟组件包括处理延迟、 传输延迟、 传播延迟、 排队延迟。 除了排队延迟是变量其他的都是固定的。

3. 什么是应用层报文,传输层报文, 网络层报文, 链路层报文?
   - 应⽤层报⽂： 应⽤程序想发送和通过传输层的数据；
   - 传输层段： 由传输层⽣成并且封装有传输层头信息的应⽤层报⽂
   - ⽹络层数据段： 封装有⽹络层头信息的传输层段
   - 链路层帧： 封装有链路层头信息的⽹络层数据段

4. 路由器处理因特网协议栈中的哪写层次, 链路交换机处理的是哪些层次, 主机处理的是哪些层次?
   - 路由器处理⽹络、链路、物理层（第1到3层） 。（实际上现代路由器有时担任防⽕墙、缓存组件和处理传输层）链路层交换机处理链路层和⽹络层（第1到2层） 。 主机处理所有的五层。

# 第二章 应用层

## 应用层协议基础

现代应用程序采用的两种主流的网络体系结构: 客户-服务机体系结构, P2P对等体系.  
![两种体系结构](计算机网络学习笔记.assets/2020-11-18-19-30-37.png)  

在一对进程之间的通信会话场景中, 发起通信的进程被称为客户, 在会话开始等待联系的进程是服务器.  
进程通过一个称为套接字 (Socket) 的软件接口向网络发送报文和从网络接收报文.  
Socket 是同一台主机内的应用层和传输层之间的接口.  
程序开发者对于传输层的控制仅限于: 1 选择传输层协议 2 也许可以设定几个传输层参数.  
主机由其 IP 地址标识. 端口号分配给主机内的应用程序.  

可供应用程序使用的传输服务: 可靠数据传输, 吞吐量, 定时, 安全性  

因特网(TCP/IP网络)提供的运输服务: UDP, TCP  

TCP服务模型包括**面向连接服务和可靠的数据传输服务**.  
![应用要求](计算机网络学习笔记.assets/2020-11-18-19-39-08.png)  
TCP 的连接时全双工的, 即连接双方的进程可以在此连接上进行报文收发.  
TCP 协议还具有拥塞控制机制, 当接收方和发送方之间的网络出现拥堵时, TCP 的拥塞机制会抑制发送进程.  

由于 TCP和UDP 均无法提供加密机制, 信息安全无法保障, 因此业界研究出了 **安全套接字层(SSL)** 来保证数据安全. SSL 不是与 TCP/UDP 在相同层次下的第三种因特网运输协议, 而是对 TCP 的加强, 这种强化是在应用层实现的.

```text
发送端: 明文-> SSL -> TCP Socket -> 运输层
接收端: 加密数据 -> TCP Socket -> SSL -> 明文
```

UDP 提供最小服务, 属于不可靠连接, 进程通信之前没有握手过程. 也没有拥塞控制.  

常见的因特网应用的协议  
![协议](计算机网络学习笔记.assets/2020-11-18-19-49-20.png)  

**应用层协议是网络应用的一部分**.

## Http

**HTTP概况**
HTTP 使用 TCP 作为它的支撑运输协议。 客户向它的 Socket 发送 Http请求报文 并从它的 Socket 接收 Http响应报文。  

服务器向客户发送请求的文件，而不存储任何关于该客户的状态信息。

**连接类型**
![连接类型](计算机网络学习笔记.assets/2020-11-18-19-15-40.png)  

采用非持续性连接的HTTP的每个对象的传输时间 T 是 两次RTT时间(往返时间)+传输文件的时间. 如果有多个文件需要传输, 每个文件都需要T的时间, 效率低.  
![非持续性连接](计算机网络学习笔记.assets/2020-11-18-19-24-08.png)  
采用持续性的HTTP连接: 在第一个文件传输完之后第二个文件还可以继续使用该连接, 不再需要 RTT 时间

**HTTP报文格式**
HTTP 请求

```html
GET /somedir/page.html HTTP/1.1
Host: www.someschool.edu
Connection: close
User-agent: Mozilla/5.0
Accept-language: fr
```

![HTTP 请求](计算机网络学习笔记.assets/2020-11-18-19-55-08.png)

只有请求类型为 POST 时才会使用 Entity body。

HTTP 响应

```html
HTTP/1.1 200 OK
Connection: close
Date: Tue, 18 Aug 2015 15:44:04 GMT
Server: Apache/2.2.3 (CentOS)
Last-Modified: Tue, 18 Aug 2015 15:11:03 GMT
Content-Length: 6821
Content-Type: text/html
(data data data data data ...)
```

![http 响应](计算机网络学习笔记.assets/2020-11-18-19-57-01.png)

## Cookie 技术

![使用 Cookie 追踪](计算机网络学习笔记.assets/2020-11-18-20-00-43.png)

## Web 缓存

![背景](计算机网络学习笔记.assets/2020-11-18-19-03-23.png)  
![流程](计算机网络学习笔记.assets/2020-11-18-19-05-06.png)  
实例, 假如不适用缓存技术  
![原始](计算机网络学习笔记.assets/2020-11-18-19-06-50.png)  

优化  
![提高带宽](计算机网络学习笔记.assets/2020-11-18-19-07-39.png)  
![使用缓存](计算机网络学习笔记.assets/2020-11-18-19-08-39.png)  

条件 Get (Condition get) 的使用  
![条件get](计算机网络学习笔记.assets/2020-11-18-19-13-21.png)  

第一次访问页面：
Web Cache 代表一个请求浏览器， 向 Web Server 发出请求

```html
GET /fruit/kiwi.gif
HTTP/1.1 Host: www.exotiquecuisine.com
```

Web Server 向 Web cache 发送具有被请求对象的响应报文

```html
HTTP/1.1 200 OK
Date: Sat, 3 Oct 2015 15:39:29
Server: Apache/1.3.0 (Unix)
Last-Modified: Wed, 9 Sep 2015 09:23:24
Content-Type: image/gif
(data data data data data ...)
```

之后一段时间再访问：

Web cache 发送一个条件 Get 执行最新检查

```html
GET /fruit/kiwi.gif HTTP/1.1
Host: www.exotiquecuisine.com
If-modified-since: Wed, 9 Sep 2015 09:23:24
```

服务器检查：`If-modified-since` 恰好等于上次 response 的 `Last-Modified`. 于是服务器返回一个新的报文。 反之， 假如在 `If-modified-since` 晚于 `Last-Modified`， 则返回一个响应报文， 内容如下：

```html
HTTP/1.1 304 Not Modified
Date: Sat, 10 Oct 2015 15:39:29
Server: Apache/1.3.0 (Unix)
(empty entity body)
```

响应行中的 `304 Not Modified` 告诉缓存器可以使用该对象。

## Email 应用

### SMTP

因特网电子邮件系统由3个主要组成部分: 用户代理, 邮件服务器, 简单邮件传输协议(Simple Mail Transfer Protocol)  
![邮件服务器的整体概述](计算机网络学习笔记.assets/2020-11-18-20-13-01.png)  

SMTP邮件发送流程如下：  
![邮件发送](计算机网络学习笔记.assets/2020-11-18-20-13-38.png)  
![发送](计算机网络学习笔记.assets/2020-11-18-20-17-34.png)  
SMTP 将邮件从发送方的用户代理传送到发送方的邮件服务器, 也将邮件从发送方的邮件服务器传送到接收方的邮件服务器.  

SMTP 协议：  
![smtp](计算机网络学习笔记.assets/2020-11-18-20-20-43.png)  

SMTP 实现发信  
![交互](计算机网络学习笔记.assets/2020-11-18-20-24-08.png)  

SMTP 和 HTTP 的对比  
![对比](计算机网络学习笔记.assets/2020-11-18-20-25-24.png)  

### EMail消息格式

Email 消息格式  
![消息格式](计算机网络学习笔记.assets/2020-11-18-20-27-22.png)  
用MIME实现多媒体扩展：  
![mime](计算机网络学习笔记.assets/2020-11-18-20-29-15.png)  

### 邮件访问协议

用户代理不能使用 SMTP 获得报文, 因为取报文是一个拉式操作, 而 SMTP 是一个推的协议, 因此我们需要设计一个特殊的邮件访问协议, 该协议将邮件服务器上的报文传送给用户本地, 目前流行的邮件访问协议包括第三版邮局协议 POP3, 因特网邮件访问协议 IMAP, HTTP.  

email 协议和 web 协议的不同，一个 email 应用可以组合性的使用使用多个协议。  
![接收协议](计算机网络学习笔记.assets/2020-11-18-20-32-29.png)  

**POP3协议**
![pop协议](计算机网络学习笔记.assets/2020-11-18-20-33-41.png)  
第三个阶段: 更新阶段, 在用户发出 quit 命令之后, 结束 pop3 会话. 这时邮件服务器删除那些被标价为删除的报文.  
![pop](计算机网络学习笔记.assets/2020-11-18-20-35-17.png)  

**IMAP协议**
![imap](计算机网络学习笔记.assets/2020-11-18-20-36-11.png)  

**基于 Web 的电子邮件**
用户和它的远程邮箱之间的通信通过 Http 进行, 但是它的邮件服务器和别人的邮件服务器之间发送和接收邮件任然是通过 SMTP 协议.

## DNS

### DNS 的作用

DNS： Domain Name System。DNS 协议运行在 UDP 上, 使用 53 端口.
域名到 IP 地址的转换问题。  
域名解析系统：

- 多层命名服务器构成的分布式数据库
- 应用层协议： 完成名字的解析
  - Internet 的核心功能， 用应用层协议实现
  - 网络边界复杂

![dns功能](计算机网络学习笔记.assets/2020-11-18-20-43-54.png)  

邮件服务器别名: MX 记录允许邮件服务器的Web服务器使用相同的主机名
负载均衡: 繁忙的站点往往不止一台服务器, 他们具有不同的IP地址, 用户给定域名, 负载均衡复杂分配用户请求到不同主机上.  

### DNS 的工作原理

分布式层次数据库：  
![数据库](计算机网络学习笔记.assets/2020-11-18-20-44-58.png)  
![过程](计算机网络学习笔记.assets/2020-11-18-20-45-40.png)  

根域名服务器：
![服务器](计算机网络学习笔记.assets/2020-11-18-20-47-04.png)  

权威域名服务器：  
![服务器](计算机网络学习笔记.assets/2020-11-18-20-47-55.png)

本地域名解析服务器：  
![服务器](计算机网络学习笔记.assets/2020-11-18-20-49-03.png)  

**查询过程：**  
迭代查询实例：  
![查询](计算机网络学习笔记.assets/2020-11-18-20-51-10.png)  
递归查询实例：  
![查询](计算机网络学习笔记.assets/2020-11-18-20-51-47.png)  

### DNS 缓存

DNS记录缓存和更新：  
![缓存](计算机网络学习笔记.assets/2020-11-18-20-54-25.png)  

### DNS 记录和报文

DNS记录:  
资源记录 RR 实现了主机名到IP的地址的映射, 每个DNS回答报文包含了一条或者多条资源记录.  
![记录](计算机网络学习笔记.assets/2020-11-18-20-56-55.png)  
![记录](计算机网络学习笔记.assets/2020-11-19-16-01-27.png)  
想要获得邮件服务器的规范主机名, DNS客户端应该请求一个MX记录, 为了获得其他服务器的规范主机名, DNS客户应该请求CNAME.  

如果一台DNS服务器是用于请求特定主机名的权威DNS服务器, 那么该DNS服务器将包含一条用于该主机名的A记录(假如该主机不是者主机名的权威服务器, 它还是有可能缓存该主机名到特定主机的A记录).
如果该服务器不是某主机名的权威服务器, 那么该服务器将包含一条NS记录, 和一条A记录. NS记录记录了包含特定主机名的域, A记录提供了NS记录中Value字段中的DNS的服务器IP地址.

DNS协议：  
![协议](计算机网络学习笔记.assets/2020-11-18-20-58-02.png)  
![记录](计算机网络学习笔记.assets/2020-11-18-20-58-34.png)  
![解释](计算机网络学习笔记.assets/2020-11-19-16-31-24.png)  

域名注册：  
![register](计算机网络学习笔记.assets/2020-11-18-21-00-45.png)  

## TCP/UDP socket编程

[网络编程](https://github.com/Mvbbb/small-java-demo/tree/master/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B)  

# 传输层

## 传输层服务概述

传输层和网络层的区别  
![区别](计算机网络学习笔记.assets/2020-11-27-15-35-08.png)  

Internet提供的传输层协议  
![基本](计算机网络学习笔记.assets/2020-11-27-15-39-26.png)  

## 多路复用和多路分用

![复用分用](计算机网络学习笔记.assets/2020-11-27-15-41-27.png)  
多路复用: 聚合Segment到网络层  
多路分用: 分发到不同 Socket  

分用原理  
![分用](计算机网络学习笔记.assets/2020-11-27-15-46-38.png)  

无连接分用  
![无连接](计算机网络学习笔记.assets/2020-11-27-15-49-08.png)  

面向连接的分用  
![分用](计算机网络学习笔记.assets/2020-11-27-15-51-59.png)  

## UDP

![udp](计算机网络学习笔记.assets/2020-11-27-16-03-08.png)  
![udp](计算机网络学习笔记.assets/2020-11-27-16-05-14.png)  

UDP 校验和  
![校验和](计算机网络学习笔记.assets/2020-11-27-16-08-27.png)  
![实例](计算机网络学习笔记.assets/2020-11-27-16-09-41.png)  

## 可靠数据传输的原理

原理  
![原理](计算机网络学习笔记.assets/2020-11-27-16-15-24.png)  

接口  
![接口](计算机网络学习笔记.assets/2020-11-27-16-18-15.png)  
![研究](计算机网络学习笔记.assets/2020-11-27-16-22-23.png)  

### Rdt1.0

Rdt1.0的理想环境  
![1.0](计算机网络学习笔记.assets/2020-11-27-16-28-04.png)  

### Rdt2.0: 产生位错误的信道

假设不可靠因素只有产生错误信道  
![2.0](计算机网络学习笔记.assets/2020-11-27-16-36-09.png)  
![2.0](计算机网络学习笔记.assets/2020-11-27-16-40-48.png)
发送方发送segment之后必须等待接收方返回ACK/NAK消息,判断是否需要重发.重发之后任然需要等待接收方返回ACK/NAK消息.  
接收方需要判断segment是否损坏, 返回给接收方ACK/NAK消息.  

### Rdt2.1

2.0 版本接收方反馈NAK/ACK消息可能会发生传输错误  

![2.1](计算机网络学习笔记.assets/2020-11-27-16-51-50.png)  
发送方:  
![2.1](计算机网络学习笔记.assets/2020-11-27-16-52-38.png)  
接受方:  
![2.1](计算机网络学习笔记.assets/2020-11-27-16-53-52.png)  

![2.1](计算机网络学习笔记.assets/2020-11-27-16-56-04.png)  

### Rdt2.2: 无NAK的消息协议

引入序列号机制
![2.2](计算机网络学习笔记.assets/2020-11-27-16-57-42.png)  
![2.2](计算机网络学习笔记.assets/2020-11-27-16-58-59.png)  

### Rdt3.0

如果信道既可能发送错误也可能丢失分组. 如果发送丢失分组的情况, 发送方会一直等下去.  
![3.0](计算机网络学习笔记.assets/2020-11-27-17-05-25.png)  

![3.0](计算机网络学习笔记.assets/2020-11-27-17-07-37.png)  
![3.0](计算机网络学习笔记.assets/2020-11-27-17-08-12.png)  

Rdt3.0 的性能分析  
![3.0](计算机网络学习笔记.assets/2020-11-27-17-16-10.png)  

## 流水线机制和滑动窗口协议

打破停等协议.  

流水线机制, 一次性发多个segment.  
![流水线](计算机网络学习笔记.assets/2020-11-29-14-49-35.png)  
![流水线](计算机网络学习笔记.assets/2020-11-29-14-51-15.png)  

使用滑动窗口  
![窗口](计算机网络学习笔记.assets/2020-11-29-14-52-17.png)  

### 滑动窗口协议 Go-Back-N

[讲解](https://www.bilibili.com/video/BV16b41157Jj)  
![gbn](计算机网络学习笔记.assets/2020-12-08-10-39-34.png)  
![gbn](计算机网络学习笔记.assets/2020-12-08-10-43-42.png)  
![gbn](计算机网络学习笔记.assets/2020-12-08-10-49-11.png)  

累积确认机制  
![gbn](计算机网络学习笔记.assets/2020-11-29-14-59-47.png)  
![gbn](计算机网络学习笔记.assets/2020-11-29-15-01-40.png)  
GBN的发送方只有一个计时器, 放在还没有确认ACK的最大序号的segment上, 如果发生超时, 就重发大于该序号的所有分组, 即便之后的这些分组还在等待ACK消息.  
GBN的接收方没有缓存.  
![gbn](计算机网络学习笔记.assets/2020-11-29-15-06-02.png)
gbn实例
![实例](计算机网络学习笔记.assets/2020-11-29-15-08-59.png)  

### 滑动窗口协议 Selective Repeat

![sr](计算机网络学习笔记.assets/2020-11-29-15-20-12.png)  
![窗口](计算机网络学习笔记.assets/2020-11-29-15-20-35.png)  
SR 实例  
![sr](计算机网络学习笔记.assets/2020-11-29-15-25-22.png)  
SR问题  
![sr](计算机网络学习笔记.assets/2020-11-29-15-28-58.png)  

## TCP

### TCP报文

**[TCP报文段的首部格式](https://www.bilibili.com/video/BV154411j7gm)**  
![tcp](计算机网络学习笔记.assets/2020-12-08-10-50-48.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-10-53-53.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-10-54-54.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-10-55-30.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-10-58-13.png)  
首部长度=数据偏移*4(单位)  
![tcp](计算机网络学习笔记.assets/2020-12-08-10-59-39.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-00-21.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-04-14.png)  
SYN和ACK都取值为1, 用来表示这是一个TCP连接请求的确认报文段  

![tcp](计算机网络学习笔记.assets/2020-12-08-11-06-08.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-06-34.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-07-01.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-07-27.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-08-48.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-09-31.png)  

![tcp](计算机网络学习笔记.assets/2020-12-03-14-58-14.png)  
![tcp](计算机网络学习笔记.assets/2020-12-03-15-02-15.png)  
![tcp](计算机网络学习笔记.assets/2020-12-03-15-07-57.png)  

### TCP可靠数据传输

1 . 超时事件  
![rtt](计算机网络学习笔记.assets/2020-12-03-15-13-32.png)  
![rtt](计算机网络学习笔记.assets/2020-12-03-15-16-29.png)  
2 . 发送方事件  
![事件](计算机网络学习笔记.assets/2020-12-03-15-18-12.png)  
3 . 接收方事件
![事件](计算机网络学习笔记.assets/2020-12-03-15-24-52.png)  

快速重传机制  
![快速重传机制](计算机网络学习笔记.assets/2020-12-03-15-29-53.png)
按序到达的一个段, 等待一段时间, 如果之后有段达到, 就一并发送两个ACK.  如果到达的段是乱序的, 就发送重复的ACK给发送方.  
快速重传: 在定时器超时之前即进行重传.  

### TCP 流量控制

[b站](https://www.bilibili.com/video/BV1Lb411G7J1)  

![tcp](计算机网络学习笔记.assets/2020-12-08-11-11-31.png)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-21-50.png)  

![tcp](计算机网络学习笔记.assets/2020-12-03-15-34-54.png)  

### TCP 连接管理

[b站连接管理](https://www.bilibili.com/video/BV1x441177hF)  
![tcp](计算机网络学习笔记.assets/2020-12-08-11-24-18.png)  

**TCP连接建立**  
3次握手  
![tcp](计算机网络学习笔记.assets/2020-12-04-16-55-22.png)  
为什么需要三次握手而不是两次握手?  
> 详见谢希仁计算机网络-第五章运输层

![tcp](计算机网络学习笔记.assets/2020-12-04-17-00-05.png)  

**TCP连接关闭**  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-01-37.png)  

**TCP的生命周期**  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-07-02.png)  

### 拥塞控制

注意拥塞控制和流量控制的区别  

**拥塞的成因和代价:**  
1 . 在理想条件下, 吞吐率达到最大  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-16-57.png)  
2 . 缓存有限  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-19-48.png)  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-21-25.png)  
因为发生重传, 但是网络资源是有限的, 利用率降低  
3 . 多跳网络  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-26-18.png)  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-30-48.png)  
造成网络瘫痪.  

**拥塞控制原理**  
拥塞控制的方法  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-37-26.png)  

案例: ATM ABR拥塞控制  
![atm](计算机网络学习笔记.assets/2020-12-04-17-39-27.png)  
![cell](计算机网络学习笔记.assets/2020-12-04-17-41-13.png)  
cell 由交换机发出, 发送给发送端, 对发送方做速率控制.  

### TCP拥塞控制

问题一: 如何控制发送速率?  
![tcp](计算机网络学习笔记.assets/2020-12-04-17-45-26.png)  

加性增-乘性减:AIMD
![aimd](计算机网络学习笔记.assets/2020-12-04-17-51-26.png)  

TCP慢启动: SS  
刚开始增长的时候, 增加的快一点  
![tcp](计算机网络学习笔记.assets/2020-12-04-18-04-00.png)  
![tcp](计算机网络学习笔记.assets/2020-12-04-18-06-37.png)  
什么时候切换为线性增长: 依赖于变量 Threshold: Loss事件发送前的窗口值的一半.  

Loss 事件的处理:  
![tcp](计算机网络学习笔记.assets/2020-12-04-18-14-44.png)  

总结:  
![tcp](计算机网络学习笔记.assets/2020-12-04-18-15-25.png)  

算法:  
![sf](计算机网络学习笔记.assets/2020-12-04-18-21-01.png)  

**[另外一个版本的解释](https://www.bilibili.com/video/BV1L4411a7RN/)**
![tcp](计算机网络学习笔记.assets/2020-12-07-22-18-30.png)  
sshresh(Threshold) 是有初始值的, 由编程人员给出.  
![tcp](计算机网络学习笔记.assets/2020-12-07-22-26-31.png)  
![tcp](计算机网络学习笔记.assets/2020-12-07-22-27-46.png)  
![tcp](计算机网络学习笔记.assets/2020-12-07-22-32-05.png)  
![tcp](计算机网络学习笔记.assets/2020-12-07-22-33-39.png)  
在有快重传机制的曲线中, 假如在顶点发生的事超时时间就直接将 cwnd 窗口设置为1. 但是假如顶点发生的事件是发送方收到了3个连续的重复确认证明只是发生了报文丢失, 还未超时, 就重传该报文, 将 cwnd 窗口设置为原来的一半, ssthresh = cwnd , 执行拥塞避免算法, 按照线性加一的方式增长.  
![tcp](计算机网络学习笔记.assets/2020-12-07-22-39-46.png)  

例题:  
![例题](计算机网络学习笔记.assets/2020-12-04-18-24-29.png)  

# 网络层

## 概述

![int](计算机网络学习笔记.assets/2020-12-11-18-46-24.png)

![nt](计算机网络学习笔记.assets/2020-12-11-12-59-29.png)  
路由选择问题: 根据数据报中的信息和路由器中的路由表实现路由选择.  

1 . 路由与转发  
![int](计算机网络学习笔记.assets/2020-12-11-14-02-21.png)  
2 . 连接建立  
![int](计算机网络学习笔记.assets/2020-12-11-14-04-34.png)  

![int](计算机网络学习笔记.assets/2020-12-11-13-01-01.png)  

## 网络层提供的两种服务

**网络层服务模型**  
![int](计算机网络学习笔记.assets/2020-12-11-14-07-57.png)  
![int](计算机网络学习笔记.assets/2020-12-11-14-14-47.png)  

### 虚电路网络

![int](计算机网络学习笔记.assets/2020-12-11-13-03-49.png)  
![int](计算机网络学习笔记.assets/2020-12-11-15-50-01.png)  
![int](计算机网络学习笔记.assets/2020-12-11-15-53-59.png)  
虚电路的具体实现  
![int](计算机网络学习笔记.assets/2020-12-11-16-05-00.png)  
![int](计算机网络学习笔记.assets/2020-12-11-16-07-56.png)  

![int](计算机网络学习笔记.assets/2020-12-11-16-12-13.png)  

### 数据报网络

![int](计算机网络学习笔记.assets/2020-12-11-13-04-23.png)  
![int](计算机网络学习笔记.assets/2020-12-11-16-16-53.png)  
![int](计算机网络学习笔记.assets/2020-12-11-16-20-27.png)  
在检索转发表时, 优先选择与分组目的地址匹配前缀最长的入口.  

![int](计算机网络学习笔记.assets/2020-12-11-16-34-25.png)  

![int](计算机网络学习笔记.assets/2020-12-11-13-04-54.png)  

## IP

### IP 数据报

![int](计算机网络学习笔记.assets/2020-12-11-18-47-09.png)  
首部长度字段*4=IP分组首部长度  
服务类型TOS字段: 区分服务, 只有在网络提供区分服务的受才使用该字段.  
总长度字段: 这个IP分组的长度(首部+数据), 单位为字节  
生存时间TTL: 占用8位, 表示IP分组在网络中可以通过的路由器数, 路由器每转发一次分组, TTL-1,如果TTL=0, 路由器丢失该分组, 并向源主机发送一个ICMP报文.  
协议字段占8位, 指示IP分组封装的是哪个协议的数据包.实现了IP协议的复用/分解  
首部校验和字段占16位, 实现对IP分组首部的差错检测, 计算校验和时, 该字段置全0, 参与运算, 计算算法和UDP校验和一致.  
选项字段: 携带安全, 源选路径, 时间戳, 路由记录等内容.  
填充字段: 范围在 0-3b之间, 补全整个首部.  

### IP分片

最大传输单元, MTU.
![int](计算机网络学习笔记.assets/2020-12-11-19-07-04.png)  
![int](计算机网络学习笔记.assets/2020-12-11-19-12-09.png)  
![int](计算机网络学习笔记.assets/2020-12-11-19-12-31.png)  
![int](计算机网络学习笔记.assets/2020-12-11-19-14-23.png)  
![int](计算机网络学习笔记.assets/2020-12-11-19-21-09.png)  
MF=1 , 证明该分组不是一个独立的IP分组, 是由一个分组分片而来的, 而且不是最后一片, 后面还有.  
MF=0, 证明该分组是一个独立的分组, 或者是一个分组分片得到的最后一个分片. 那么如何判断该分组是否是一个独立的分组呢, 结合片偏移量来判断.  
如果一个分组未经过分片, 那么它的片偏移量一定为0.  

### IPv4 地址概述

![int](计算机网络学习笔记.assets/2020-12-11-13-06-18.png)  
IP地址与每个接口关联  
![int](计算机网络学习笔记.assets/2020-12-11-13-07-01.png)  

### 分类编址的 IPv4 地址

分配到同一个路由器(一个IP子网)的网络号相同, 主机号不同.  

IP 子网:

- IP地址具有相同的网络号的设备接口
- 不跨越路由器(第三及以上网络设备)可以彼此物理联通的接口

![int](计算机网络学习笔记.assets/2020-12-12-21-53-58.png)  
D类地址用作多播地址.使用ABC类地址用作接口划分.  
![int](计算机网络学习笔记.assets/2020-12-12-22-05-09.png)  
![int](计算机网络学习笔记.assets/2020-12-12-21-56-58.png)  

![int](计算机网络学习笔记.assets/2020-12-11-13-09-57.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-11-55.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-13-27.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-15-04.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-16-12.png)  

![int](计算机网络学习笔记.assets/2020-12-11-13-18-09.png)  

![int](计算机网络学习笔记.assets/2020-12-11-13-20-59.png)  

### 划分子网的IPv4地址

![int](计算机网络学习笔记.assets/2020-12-11-13-25-29.png)  

![int](计算机网络学习笔记.assets/2020-12-11-13-26-48.png)  

![int](计算机网络学习笔记.assets/2020-12-11-13-35-26.png)  
子网地址+子网掩码=>>子网大小  
![int](计算机网络学习笔记.assets/2020-12-12-22-17-23.png)  
![int](计算机网络学习笔记.assets/2020-12-12-22-20-55.png)  

### 无分类编址的IPv4地址

![int](计算机网络学习笔记.assets/2020-12-11-13-37-53.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-44-42.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-11-05.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-13-54.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-26-49.png)  

### IPv4地址的应用规划

![int](计算机网络学习笔记.assets/2020-12-11-13-47-01.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-48-35.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-51-22.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-52-41.png)  
![int](计算机网络学习笔记.assets/2020-12-11-13-55-10.png)  

## 协议

### DHCP 协议

默认网关: 子网内主机发送给外部网络通过的接口  
![int](计算机网络学习笔记.assets/2020-12-18-10-31-01.png)  

需要配置DHCP服务器  
![int](计算机网络学习笔记.assets/2020-12-18-10-34-15.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-37-05.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-40-39.png)  
未分配给用户IP之前都需要广播.  
一个网络内可能不止一个DHCP服务器, 因此第三个报文需要广播, 告知其他DHCP服务器收回预分配给我的IP地址, 因为我已经找到了一个合适的DHCP服务器.  
![int](计算机网络学习笔记.assets/2020-12-18-10-43-53.png)  

### NAT 网络地址转换协议

私有地址的主机如何在公共互联网上被发现? NAT协议  

至少要有一个路由器拥有一个公网IP  
![int](计算机网络学习笔记.assets/2020-12-18-10-48-54.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-51-35.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-52-54.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-55-25.png)  
![int](计算机网络学习笔记.assets/2020-12-18-10-59-18.png)  

![int](计算机网络学习笔记.assets/2020-12-18-11-01-11.png)  
![int](计算机网络学习笔记.assets/2020-12-18-11-03-15.png)  
![int](计算机网络学习笔记.assets/2020-12-18-11-05-09.png)  

### ICMP 协议

![int](计算机网络学习笔记.assets/2020-12-18-11-11-45.png)  
![int](计算机网络学习笔记.assets/2020-12-18-11-12-05.png)  

ICMP差错报告报文: 路由器收到错误分组, 向源IP地址发送一个报文, 被称为ICMP差错报文.  
![int](计算机网络学习笔记.assets/2020-12-18-11-18-44.png)  

![int](计算机网络学习笔记.assets/2020-12-18-11-17-34.png)  
![int](计算机网络学习笔记.assets/2020-12-18-11-21-18.png)  

**Traceroute**
![int](计算机网络学习笔记.assets/2020-12-18-11-25-21.png)  

## IPV6

![int](计算机网络学习笔记.assets/2020-12-18-11-38-39.png)  
![int](计算机网络学习笔记.assets/2020-12-18-11-42-04.png)  
![int](计算机网络学习笔记.assets/2020-12-18-11-48-09.png)  
![int](计算机网络学习笔记.assets/2020-12-18-11-50-40.png)  

![int](计算机网络学习笔记.assets/2020-12-18-11-52-02.png)  

## 例题

![int](计算机网络学习笔记.assets/2020-12-18-12-09-34.png)  
指定子网中的主机, 子网掩码为 255.255.255.255  
描述默认路由 的目的网络IP地址: 0.0.0.0, 子网掩码: 0.0.0.0.  

## 路由算法

![int](计算机网络学习笔记.assets/2020-12-25-13-05-05.png)

![int](计算机网络学习笔记.assets/2020-12-25-13-11-24.png)

### 链路状态

![int](计算机网络学习笔记.assets/2020-12-25-13-20-00.png)

![int](计算机网络学习笔记.assets/2020-12-25-13-23-25.png)  

![int](计算机网络学习笔记.assets/2020-12-25-13-33-45.png)

### 距离向量

![int](计算机网络学习笔记.assets/2020-12-25-13-37-31.png)

![int](计算机网络学习笔记.assets/2020-12-25-13-40-52.png)

![int](计算机网络学习笔记.assets/2020-12-25-13-44-45.png)

![int](计算机网络学习笔记.assets/2020-12-25-13-49-23.png)

![int](计算机网络学习笔记.assets/2020-12-25-13-57-04.png)

![int](计算机网络学习笔记.assets/2020-12-25-14-03-31.png)

![int](计算机网络学习笔记.assets/2020-12-25-14-08-15.png)  
在4没有更新成60之前, z认为z->x的最短距离是5. 当4变成60之后, y要更新到x的距离, 这时候, y从z处得知当前z->x的距离是5,y直接到达x的距离是60, 所以y将y->x的距离更新为6.  
之后y将该更改通告给z, z再更新z->x的距离为7

![int](计算机网络学习笔记.assets/2020-12-25-15-14-24.png)

![int](计算机网络学习笔记.assets/2020-12-25-15-19-11.png)

## 层次路由

![int](计算机网络学习笔记.assets/2020-12-25-15-25-03.png)

![int](计算机网络学习笔记.assets/2020-12-25-15-29-50.png)

![int](计算机网络学习笔记.assets/2020-12-25-15-31-25.png)

![int](计算机网络学习笔记.assets/2020-12-25-15-36-06.png)

![int](计算机网络学习笔记.assets/2020-12-25-15-37-33.png)

![int](计算机网络学习笔记.assets/2020-12-25-15-38-13.png)

![int](计算机网络学习笔记.assets/2020-12-25-15-40-23.png)

# 数据链路层

## 服务

![dl](计算机网络学习笔记.assets/2020-12-26-09-29-36.png)

![dl](计算机网络学习笔记.assets/2020-12-26-09-37-18.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-09-40-18.png)

![dk](计算机网络学习笔记.assets/2020-12-26-09-40-43.png)

![dl](计算机网络学习笔记.assets/2020-12-26-09-42-00.png)

## 差错编码

![dl](计算机网络学习笔记.assets/2020-12-26-09-58-26.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-01-05.png)

![dl](计算机网络学习笔记.assets/2020-12-26-10-03-41.png)
![dl](计算机网络学习笔记.assets/2020-12-26-10-04-20.png)

![dl](计算机网络学习笔记.assets/2020-12-26-10-08-28.png)

![dl](计算机网络学习笔记.assets/2020-12-26-10-10-22.png)

![dl](计算机网络学习笔记.assets/2020-12-26-09-44-20.png)  
差错编码不保证100%可靠

## 可靠传输

![dl](计算机网络学习笔记.assets/2020-12-26-10-13-46.png)

![dl](计算机网络学习笔记.assets/2020-12-26-10-15-06.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-16-42.png)

### 停止等待

![dl](计算机网络学习笔记.assets/2020-12-26-10-21-17.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-22-28.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-26-16.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-28-35.png)

### 回退N帧

![dl](计算机网络学习笔记.assets/2020-12-26-10-32-47.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-34-38.png)
![dl](计算机网络学习笔记.assets/2020-12-26-10-36-39.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-39-32.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-42-27.png)

### 选择重传

![dl](计算机网络学习笔记.assets/2020-12-26-10-44-04.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-10-48-45.png)

## PPP协议

![dl](计算机网络学习笔记.assets/2020-12-26-10-52-53.png)

![dl](计算机网络学习笔记.assets/2020-12-26-10-55-29.png)

### 帧封装

![dl](计算机网络学习笔记.assets/2020-12-26-10-59-22.png)

解决末尾定界符冲突问题  
![dl](计算机网络学习笔记.assets/2020-12-26-11-01-01.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-11-01-54.png)

### 差错检测

![dl](计算机网络学习笔记.assets/2020-12-26-11-02-42.png)

### 小结

![dl](计算机网络学习笔记.assets/2020-12-26-11-05-00.png)

## 媒体接入

![dl](计算机网络学习笔记.assets/2020-12-26-11-08-21.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-11-08-56.png)

### 静态划分

> <https://www.bilibili.com/video/BV1c4411d7CQ?p=30>

![dl](计算机网络学习笔记.assets/2020-12-26-11-10-11.png)

![dl](计算机网络学习笔记.assets/2020-12-26-11-11-08.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-11-11-30.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-11-13-08.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-11-14-31.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-11-15-05.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-11-16-14.png)  
![dl](计算机网络学习笔记.assets/2020-12-26-11-16-57.png)  
